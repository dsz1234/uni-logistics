import{a5 as e,a6 as t,a7 as s,a8 as n,r as a,a9 as r,C as i}from"./index-d88a521f.js";var o={};Object.defineProperty(o,"__esModule",{value:!0});var u=o.createUniFetch=void 0;function d(n){var a,r;const i=[],o=n=>(!n.url.startsWith("http")&&o.baseURL&&(n.url=o.baseURL+n.url),o.intercept.request(n),(null==o?void 0:o.loading)&&!i.length&&e(Object.assign({},o.loading)),i.push("loading"),new Promise(((e,a)=>{t(Object.assign(Object.assign({},n),{success:t=>{e(o.intercept.response(Object.assign(Object.assign({},t),{config:n})))},fail:a,complete:()=>{i.pop(),i.length||s()}}))})));return o.loading=null==n?void 0:n.loading,o.baseURL=null==n?void 0:n.baseURL,o.intercept={request:e=>e,response:e=>e},(null===(a=null==n?void 0:n.intercept)||void 0===a?void 0:a.request)&&(o.intercept.request=n.intercept.request),(null===(r=null==n?void 0:n.intercept)||void 0===r?void 0:r.response)&&(o.intercept.response=n.intercept.response),o.get=function(e,t={}){return o({url:e,method:"GET",data:t})},o.post=function(e,t={}){return o({url:e,method:"POST",data:t})},o.put=function(e,t={}){return o({url:e,method:"PUT",data:t})},o.delete=function(e,t){return o({url:e,method:"DELETE",data:t})},o}u=o.createUniFetch=d,o.default=d();const l=n("user",(()=>({token:a("")})),{persist:!0}),c=["pages/task/index","pages/message/index","pages/my/index"],p=u({loading:{title:"加载中..."},baseURL:"/dev-api",intercept:{request(e){const t={Authorization:l().token};return e.header=Object.assign({},t,e.header),e},response(e){if(200===e.statusCode&&200===e.data.code)return e.data;if(401===e.statusCode){const e=r();console.log("pageStack",e);const t=e[e.length-1].route,s=c.includes(t)?"switchTab":"redirectTo";return i({url:`/pages/login/index?routeType=${s}&redirectUrl=/${t}`})}uni.utils.toast(e.data.msg||"请求失败")}}});export{p as a,l as u};
