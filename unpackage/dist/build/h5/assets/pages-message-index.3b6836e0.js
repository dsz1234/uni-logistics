import{r as e,q as a,l,o as t,c as s,w as r,a as i,e as n,b as u,F as c,d,f as o,i as _,g as p,S as v,u as f,t as g,x as h,n as y,p as m,h as k,j as x,v as b}from"./index-d88a521f.js";import{_ as w,a as S}from"./uni-list.c6354b96.js";import{r as C}from"./uni-app.es.c0a9eb75.js";import{a as T}from"./uni-fetch.216a285c.js";import{_ as $}from"./_plugin-vue_export-helper.1b428a4d.js";const j=e=>T({url:"/driver/messages/page",method:"GET",data:e}),F=e=>T.put(`/driver/messages/readAll/${e}`),I=$({__name:"announce",setup(f){const g=e(!1),h=e(!1),y=e(!1),m=e({contentType:"200",page:0,pageSize:5}),k=e({}),x=e([]),b=async()=>{try{m.value.page+=1;let e=await j(m.value);1===m.value.page&&(x.value=[]),k.value=e.data,x.value=[...x.value,...e.data.items||[]],h.value=m.value.page==k.value.pages,g.value=0===x.value.length}catch(e){console.log(e)}};a((()=>{b()}));const T=()=>{h.value||b()},$=async()=>{y.value=!0,m.value.page=0,await b(),y.value=!1},I=async()=>{try{await F(m.value.contentType);m.value.page=0,b()}catch(e){console.log(e)}};return(e,a)=>{const f=_,h=p,m=C(l("uni-list-item"),w),k=C(l("uni-list"),S),b=v;return t(),s(b,{"refresher-triggered":y.value,onRefresherrefresh:$,"refresher-enabled":"",onScrolltolower:T,"scroll-y":"true",class:"scroll-view"},{default:r((()=>[x.value.length>0?(t(),s(h,{key:0,class:"scroll-view-wrapper"},{default:r((()=>[i(h,{class:"message-action",onClick:I},{default:r((()=>[i(f,{class:"iconfont icon-clear"}),n(" 全部已读 ")])),_:1}),i(k,null,{default:r((()=>[(t(!0),u(c,null,d(x.value,((e,a)=>(t(),s(m,{key:e.id,title:e.title,"right-text":e.created,ellipsis:"1",to:`/subpkg_user/content/index?id=${e.id}`},{header:r((()=>[0===e.isRead?(t(),s(f,{key:0,class:"dot"})):o("",!0)])),_:2},1032,["title","right-text","to"])))),128))])),_:1})])),_:1})):o("",!0),g.value?(t(),s(h,{key:1,class:"message-blank"},{default:r((()=>[n("暂无消息")])),_:1})):o("",!0)])),_:1},8,["refresher-triggered"])}}},[["__scopeId","data-v-59ef9572"]]);const R=$({name:"UniCard",emits:["click"],props:{title:{type:String,default:""},subTitle:{type:String,default:""},padding:{type:String,default:"10px"},margin:{type:String,default:"15px"},spacing:{type:String,default:"0 10px"},extra:{type:String,default:""},cover:{type:String,default:""},thumbnail:{type:String,default:""},isFull:{type:Boolean,default:!1},isShadow:{type:Boolean,default:!0},shadow:{type:String,default:"0px 0px 3px 1px rgba(0, 0, 0, 0.08)"},border:{type:Boolean,default:!0}},methods:{onClick(e){this.$emit("click",e)}}},[["render",function(e,a,l,u,c,d){const v=m,k=p,x=_;return t(),s(k,{class:y(["uni-card",{"uni-card--full":l.isFull,"uni-card--shadow":l.isShadow,"uni-card--border":l.border}]),style:h({margin:l.isFull?0:l.margin,padding:l.spacing,"box-shadow":l.isShadow?l.shadow:""})},{default:r((()=>[f(e.$slots,"cover",{},(()=>[l.cover?(t(),s(k,{key:0,class:"uni-card__cover"},{default:r((()=>[i(v,{class:"uni-card__cover-image",mode:"widthFix",onClick:a[0]||(a[0]=e=>d.onClick("cover")),src:l.cover},null,8,["src"])])),_:1})):o("",!0)]),!0),f(e.$slots,"title",{},(()=>[l.title||l.extra?(t(),s(k,{key:0,class:"uni-card__header"},{default:r((()=>[i(k,{class:"uni-card__header-box",onClick:a[1]||(a[1]=e=>d.onClick("title"))},{default:r((()=>[l.thumbnail?(t(),s(k,{key:0,class:"uni-card__header-avatar"},{default:r((()=>[i(v,{class:"uni-card__header-avatar-image",src:l.thumbnail,mode:"aspectFit"},null,8,["src"])])),_:1})):o("",!0),i(k,{class:"uni-card__header-content"},{default:r((()=>[i(x,{class:"uni-card__header-content-title uni-ellipsis"},{default:r((()=>[n(g(l.title),1)])),_:1}),l.title&&l.subTitle?(t(),s(x,{key:0,class:"uni-card__header-content-subtitle uni-ellipsis"},{default:r((()=>[n(g(l.subTitle),1)])),_:1})):o("",!0)])),_:1})])),_:1}),i(k,{class:"uni-card__header-extra",onClick:a[2]||(a[2]=e=>d.onClick("extra"))},{default:r((()=>[i(x,{class:"uni-card__header-extra-text"},{default:r((()=>[n(g(l.extra),1)])),_:1})])),_:1})])),_:1})):o("",!0)]),!0),i(k,{class:"uni-card__content",style:h({padding:l.padding}),onClick:a[3]||(a[3]=e=>d.onClick("content"))},{default:r((()=>[f(e.$slots,"default",{},void 0,!0)])),_:3},8,["style"]),i(k,{class:"uni-card__actions",onClick:a[4]||(a[4]=e=>d.onClick("actions"))},{default:r((()=>[f(e.$slots,"actions",{},void 0,!0)])),_:3})])),_:3},8,["class","style"])}],["__scopeId","data-v-b4135a35"]]),B=$({__name:"notify",setup(f){const h=e(!1),m=e(!1),x=e(!1),b=e({contentType:"201",page:0,pageSize:5}),w=e([]),S=async()=>{try{b.value.page+=1;let e=await j(b.value);1===b.value.page&&(w.value=[]),w.value=[...w.value,...e.data.items||[]],m.value=b.value.page==e.data.pages,h.value=0===w.value.length}catch(e){console.log(e)}};a((()=>{S()}));const T=()=>{m.value||S()},$=async()=>{x.value=!0,b.value.page=0,await S(),x.value=!1},I=async()=>{try{await F(b.value.contentType);b.value.page=0,S()}catch(e){console.log(e)}};return(e,a)=>{const f=_,b=p,S=k,j=C(l("uni-card"),R),F=v;return t(),s(F,{"refresher-triggered":x.value,onRefresherrefresh:$,"refresher-enabled":"",onScrolltolower:T,"scroll-y":"true",class:"scroll-view"},{default:r((()=>[w.value.length>0?(t(),s(b,{key:0,class:"scroll-view-wrapper"},{default:r((()=>[i(b,{class:"message-action",onClick:I},{default:r((()=>[i(f,{class:"iconfont icon-clear"}),n(" 全部已读 ")])),_:1}),(t(!0),u(c,null,d(w.value,((e,a)=>(t(),s(j,{"is-shadow":!1,key:a},{title:r((()=>[i(b,{class:y(["title",{unread:0===e.isRead}])},{default:r((()=>[n(g(e.title),1)])),_:2},1032,["class"])])),default:r((()=>[i(b,{class:"brief"},{default:r((()=>[n(g(e.content),1)])),_:2},1024),i(b,{class:"extra"},{default:r((()=>[i(f,{class:"time"},{default:r((()=>[n(g(e.created),1)])),_:2},1024),i(S,{class:"link",url:`/subpkg_task/detail/index?id=${e.id}`},{default:r((()=>[n("查看详情")])),_:2},1032,["url"])])),_:2},1024)])),_:2},1024)))),128)),m.value?(t(),s(b,{key:0,class:"tips"},{default:r((()=>[n("已经到达底部了~")])),_:1})):o("",!0)])),_:1})):o("",!0),h.value?(t(),s(b,{key:1,class:"message-blank"},{default:r((()=>[n("暂无消息")])),_:1})):o("",!0)])),_:1},8,["refresher-triggered"])}}},[["__scopeId","data-v-ea516105"]]),z=$({__name:"index",setup(a){const l=e(0),_=e([{title:"任务通知",rendered:!0},{title:"公告",rendered:!1}]);return(e,a)=>{const v=p;return t(),s(v,{class:"page-container"},{default:r((()=>[i(v,{class:"tab"},{default:r((()=>[(t(!0),u(c,null,d(_.value,((e,a)=>(t(),s(v,{class:"tab-item",onClick:e=>(e=>{_.value[e].rendered=!0,l.value=e})(a),key:a},{default:r((()=>[i(v,{class:y(["title",{active:l.value===a}])},{default:r((()=>[n(g(e.title),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1}),i(v,{class:"message-list"},{default:r((()=>[_.value[0].rendered?x((t(),s(B,{key:0},null,512)),[[b,0===l.value]]):o("",!0)])),_:1}),i(v,{class:"message-list"},{default:r((()=>[_.value[1].rendered?x((t(),s(I,{key:0},null,512)),[[b,1===l.value]]):o("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-4bff3e48"]]);export{z as default};
